const express = require("express");
const { DefaultAzureCredential } = require("@azure/identity");
const { SecretClient } = require("@azure/keyvault-secrets");

// Create an Express app
const app = express();

// Initialize the Azure Key Vault client
const vaultUrl = "<your-key-vault-url>";
const credential = new DefaultAzureCredential();
const client = new SecretClient(vaultUrl, credential);

// Define an API route to retrieve a secret
app.get("/secret/:name", async (req, res) => {
  const secretName = req.params.name;

  try {
    // Retrieve the secret value from Azure Key Vault
    const secret = await client.getSecret(secretName);
    const secretValue = secret.value;

    // Return the secret value in the response
    res.json({ secretName, secretValue });
  } catch (error) {
    console.error("Error retrieving secret:", error.message);
    res.status(500).json({ error: "Failed to retrieve secret" });
  }
});

// Start the Express server
const port = 3000;
app.listen(port, () => {
  console.log(`Server running on port ${port}`);
});
